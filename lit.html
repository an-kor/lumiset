<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>

        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
        body {
            background-color: #111;
            color: #fff;
        }
    </style>
    <script type="module">
    import Lumiset from "./lib/lumiset/index.js";
    import components from "./src/components/index.js";
    import layouts from "./src/layouts/index.js";
    import themes from "./src/themes/index.js";

    let App = Lumiset({
        initialState:{
            isAuthorized: false,
            authorizedRoutes: ["dashboard", "users/:id"],
            version: "1.0.0",
            todos: [
                { id: 0, text: "Do laundry" },
                { id: 1, text: "Buy groceries" }
            ],
        },
        initialSchema: {
            authorizedRoutes: ["string"],
            version: "string",
            todos: [{ id: "number", text: "string" }],
            item: {
                id: "number",
                text: "string"
            }
        },
        middlewares: {
            'auth': {
                path: "currentRoute",
                handler: async (value, state) => {
                    if (!state.isAuthorized && state.authorizedRoutes.includes(value)) {
                        return false;
                    }
                    return true;
                },
                onReject: () => {
                    App.getRouter().navigate('login')
                }
            }
        },
        customComponents: {...components,...layouts},
        currentTheme: 'default',
        themes
    });

    window.state = App.getStore().getState()

    window.App = App;

    App.getStore().addMiddleware("auth2", {
        path: "currentRoute",
        handler: (value) => {
            if (value === "quit") {
                return false;
            }
            return true;
        },
        onReject: () => {
            App.getRouter().navigate('quit2')
        }
    })
    </script>
</head>
<body>
<template is="lumi-app">
    <!--lumi-element :version="version" :text="todos.1.text" :todos="todos"></lumi-element>
    <lumi-route path="login/*">
        <div>123</div>
        <lumi-route path="login/password/*">
            <div>password</div>
        </lumi-route>
    </lumi-route>
    <lumi-route path="еуые/*">
        <div>123</div>
    </lumi-route-->
    <!--lumi-route path="login/*" :hidden="isAuthorized">
        <app-layout-blank>
            login
        </app-layout-blank>
    </lumi-route>
    <lumi-route path="*" :hidden="!isAuthorized">
        <app-layout-blank>
                dashboard
        </app-layout-blank>
    </lumi-route-->

    <lumi-test :value="version"></lumi-test>
    <lumi-element :version="version" :text="todos.1.text" :todos="todos"></lumi-element>
    <app-layout-blank>
        <lumi-test :value="version"></lumi-test>
    </app-layout-blank>
</template>
</body>
</html>